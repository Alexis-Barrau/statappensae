
```{r}
if (!requireNamespace("rgl", quietly = TRUE)) install.packages("rgl")
if (!requireNamespace("rayshader", quietly = TRUE)) install.packages("rayshader")
library(rgl, rayshader)

install.packages("devtools")
devtools::install_github("tylermorganwall/rayshader")

packages <- c(
  "doParallel",
  "foreach",
  "Rcpp",
  "progress",
  "raster",
  "scales",
  "png",
  # "jpg",
  "magrittr",
  "rgl",
  "terrainmeshr",
  "rayimage",
  "rayvertex",
  "rayrender")

installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

invisible(lapply(packages, library, character.only = TRUE))

rm(installed_packages, packages)
```

```{r}
# Fonctionne seulement en local, pas depuis le datalab
# Pas trouvé de solution pour avoir une légende pour chaque variable
selected_dep <- "26"
subset_map_data <- map_data[map_data$dep == selected_dep, ]

ggVktor <- ggplot(data=subset_map_data) +
  geom_sf(aes(fill = part, height = ppropri1981)) +
  scale_fill_viridis() +
  ggtitle("Participation et taux de propriété dans la Drôme") +
  theme_bw() +
  guides(
    fill = guide_colourbar(title = "Participation"),
    height = guide_legend(title = "Taux de propriétaires")
  )

plot_gg(
  ggVktor,
  multicore = TRUE, 
  shadow = FALSE,
  width = 8, 
  height = 8, 
  scale = 200,
  windowsize=c(1680,1050), 
  zoom = 0.60, 
  phi = 50,
  sunangle = 120,
  theta = 45)

render_snapshot()
```
